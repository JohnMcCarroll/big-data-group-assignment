---
title: "GA2_Data_Load"
author: "Willow Rose"
date: "2024-10-17"
output: html_document
---

```{r setup, include=FALSE}

library(dplyr)

library(DBI)
library(RSQLite)
library(xlsx)

cleanvals <- function(tab) {
  rem <- vector(mode='list', length=length(tab[,1]))
  for(x in (1:length(tab[,1]))) {
    if(substring(tab[x,1], 1, 1) != '\t') {
      rem[[x]] <- x
    }
  }
  return(unlist(rem))
}

```

```{r read_data}


#load table 2
tab1 <- read.xlsx("data//table-1-1.xlsx", 1, header = TRUE)
tab1 <- tab1[(-1:-4),]
cols1 <- tab1[1,]
cols1[1] = "Group"
colnames(tab1) <- cols1
tab1 <- tab1[-1,]
tab1rem <- cleanvals(tab1)
tab1 <- tab1[-tab1rem,]


#load table 2
tab2 <- read.xlsx("data//table-2-1.xlsx", 1, header = TRUE)
tab2 <- tab2[(-1:-4),]
cols2 <- tab2[1,]
cols2[1] = "Group"
colnames(tab2) <- cols2
tab2 <- tab2[-1,]
tab2rem <- cleanvals(tab2)
tab2 <- tab2[-tab2rem,]
tab2 <- na.omit(tab2)


#load table 2
tab3 <- read.xlsx("data//table-3.xlsx", 1, header = TRUE)
tab3 <- tab3[(-1:-2),]
cols3 <- tab3[1,]
for(x in 1:length(cols3)) {
  if(is.na(cols3[x])) {
    cols3[x] <- paste(cols3[x-1], '(%)')
  }
}
colnames(tab3) <- cols3
tab3 <- tab3[-1:-2,]
tab3[1,1] <- "\t Total"
tab3rem <- cleanvals(tab3)
tab3 <- tab3[-tab3rem,]



tab3[tab3 =='Z'] <- 0

```


```{r load_data}
db_name <- 'educational_attainment_database.db'
mydb <- dbConnect(RSQLite::SQLite(), db_name)
dbWriteTable(mydb, "table_1", tab1)
dbWriteTable(mydb, "table_2", tab2)
dbWriteTable(mydb, "table_3", tab3)
dbListTables(mydb)
dbGetQuery(mydb, 'SELECT * FROM TABLE_1')
dbGetQuery(mydb, 'SELECT * FROM TABLE_2')
dbGetQuery(mydb, 'SELECT * FROM TABLE_3')
dbDisconnect(mydb)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}




```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
